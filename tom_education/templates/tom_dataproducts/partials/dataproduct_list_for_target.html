{% load bootstrap4 %}
{% load static tom_education_extras %}
{% include 'tom_dataproducts/partials/js9_scripts.html' %}

<h4 id="async-section">Processes</h4>
<div id="async-table-wrapper">
    <p>No pending or failed processes</p>

    <table class="table table-striped" style="display: none;">
        <thead>
            <tr>
                <th>Filename</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<h4>Data</h4>

<form method="POST" action="" id="dataproduct-action-form" data-target="{{ target.pk }}">
  <input type="hidden" name="action" value="" />
  {% csrf_token %}
  <p>
    <!-- Actions -->
    {% buttons %}
        <input type="submit" name="create_timelapse" class="btn btn-primary"
               value="Create timelapse" />
        <input type="submit" name="view_gallery" class="btn btn-primary"
               value="View gallery" />
        <input type="submit" name="analyse" class="btn btn-primary"
               value="Analyse" />

        {% include "tom_education/dataproduct_selection_buttons.html" %}
    {% endbuttons %}

  </p>
  <table class="table table-striped">
    <thead><tr><th></th><th></th><th></th><th>Filename</th><th>Tag</th><th>Delete</th></tr></thead>
    <tbody>
    {% for product in products %}
      <tr>
        {# Show checkbox for performing action on this product #}
        <td>
          {%  if 'fits' in product.get_file_name or product.tag == 'fits_file' %}
            {% dataproduct_checkbox product %}
          {# TODO: remove this debug code #}
          {% elif 'psx' in product.get_file_name %}
            {% dataproduct_checkbox product %}
          {% endif %}
        </td>

        {% if not product.featured %}
        <td><a href="{% url 'tom_dataproducts:feature' pk=product.id %}?target_id={{ target.id }}" title="Make Featured Image" class="btn btn-primary">Feature</a></td>
        {% else %}
        <td><span class="btn btn-secondary active featured">Featured</span></td>
        {% endif %}
        <td>
          {%  if 'fits' in product.get_file_name or product.tag == 'fits_file' %}
            {% include 'tom_dataproducts/partials/js9_button.html' with url=product.data.url only %}
          {% endif %}
        </td>
        <td><a href="{{ product.data.url }}" class="product-filename">{{ product.get_file_name }}</a></td>
        <td>
          {% if product.tag %}
            {{ product.get_tag_display }}
          {% endif %}
          </a>
        </td>
        <td><a href="{% url 'tom_dataproducts:delete' product.id %}" class="btn btn-danger">Delete</a></td>
      </tr>
    {% endfor %}
  </table>
</form>

<script type='text/javascript' src='{% static 'tom_education/dataproduct_action_form.js' %}'></script>
<script type='text/javascript' src='{% static 'tom_education/dataproduct_checklist_utils.js' %}'></script>
