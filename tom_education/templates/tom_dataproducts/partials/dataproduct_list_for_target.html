{% load bootstrap4 %}
{% load static %}
{% include 'tom_dataproducts/partials/js9_scripts.html' %}

<h4 id="timelapse-section">Timelapses</h4>
<div id="timelapse-table-wrapper">
    <p>No pending or failed timelapses</p>

    <table class="table table-striped" style="display: none;">
        <thead>
            <tr>
                <th>Filename</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<h4>Data</h4>

<form method="POST" action="" id="timelapse-create-form" data-target="{{ target.pk }}">
  {% csrf_token %}
  <p>
    <input type="submit" class="btn btn-primary" value="Create timelapse from selected" />
    <input type="button" class="btn btn-secondary" onclick="selectAllProducts()" value="Select all" />
    <input type="button" class="btn btn-secondary" onclick="selectAllProducts(true)" value="Select reduced" />
  </p>
  <table class="table table-striped">
    <thead><tr><th></th><th></th><th></th><th>Filename</th><th>Tag</th><th>Delete</th></tr></thead>
    <tbody>
    {% for product in products %}
      <tr>
        {# Show checkbox for inclusion of this product in the timelapse #}
        <td>
          {%  if 'fits' in product.get_file_name or product.tag == 'fits_file' %}
              <input type="checkbox" name="{{ product.product_id }}"
                     class="timelapse-checkbox {% if 'e91.fits.fz' not in product.data.name %}reduced{% endif %}" />
          {% endif %}
        </td>

        {% if not product.featured %}
        <td><a href="{% url 'tom_dataproducts:feature' pk=product.id %}?target_id={{ target.id }}" title="Make Featured Image" class="btn btn-primary">Feature</a></td>
        {% else %}
        <td><span class="btn btn-secondary active featured">Featured</span></td>
        {% endif %}
        <td>
          {%  if 'fits' in product.get_file_name or product.tag == 'fits_file' %}
            {% include 'tom_dataproducts/partials/js9_button.html' with url=product.data.url only %}
          {% endif %}
        </td>
        <td><a href="{{ product.data.url }}" class="product-filename">{{ product.get_file_name }}</a></td>
        <td>
          {% if product.tag %}
            {{ product.get_tag_display }}
          {% endif %}
          </a>
        </td>
        <td><a href="{% url 'tom_dataproducts:delete' product.id %}" class="btn btn-danger">Delete</a></td>
      </tr>
    {% endfor %}
  </table>
</form>

<script type='text/javascript' src='{% static 'tom_education/timelapse_form.js' %}'></script>
